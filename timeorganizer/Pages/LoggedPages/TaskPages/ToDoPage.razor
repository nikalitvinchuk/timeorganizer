@page "/todo"
@using timeorganizer.Services
@using timeorganizer.Helpers

<div class="container">
    <div>
        <h2> Zadania</h2><button @onclick="@(e => Przenies())">Dodaj zadanie</button>
@inject ToDoService taskService
@inject NavigationManager NavigationManager
<div style="display: grid; grid-template-columns: auto 1fr;" class="d-flex flex-row">
    @* <div style="grid-row: 1; grid-column: 1;">
        <label>Nazwa </label>
        <input @bind="@taskService.showTask.Name" />
    </div>
    <div style="grid-row: 2; grid-column: 1;">
        <label>Opis </label>
        <input @bind="@taskService.showTask.Description" />
    </div> *@
    <div style="grid-row: 3; grid-column: 1;">
        <label>Typ</label>
        <input @bind="@taskService.showTask.Typ" />
    </div>
    <div style="grid-row: 4; grid-column: 1;">
        <label>Status </label>
        <input @bind="@taskService.showTask.Status" />
    </div>
    <div style="grid-row: 5; grid-column: 1;">
        <label>Data</label>
        <input type="date" @bind="@taskService.showTask.CreatedD" />
    </div>
</div>

        <button @onclick="@filterTask" style="margin: 10px auto; display: block;">Filtruj</button>
  
        @foreach (var task in taskService.showTask.TasksCollection) {
    <div class="d-flex flex-row border p-2" style="cursor: pointer;">
        <p class="mr-3 mb-0">@task.Name</p>
        <p class="mr-3 mb-0">@task.Description</p>
        <p class="mr-3 mb-0">@task.Type</p>
        <p class="mr-3 mb-0">@task.status</p>
        <p class="mr-3 mb-0">@task.Termin</p>
        <button @onclick="@(e => RedirectToDetails(@task.Id))">Szczegóły zadania</button>
    </div>
}
        @code {
            private async void RedirectToDetails(int taskId) {
                taskService.AddSTask.TaskId = taskId;
                await taskService.AddSTask.GetTask();
                NavigationManager.NavigateTo("/subtask");
            }
            private void Przenies(){
                NavigationManager.NavigateTo("/addtask");
            }
        }

        <a href="home" class="button">Wróć</a>
    </div>
</div>
@code{
    
    protected override void OnAfterRender(bool firstRender){
        if (firstRender){
            filterTask();
            StateHasChanged();
        }
    }
    public async void filterTask() {
        await taskService.showTask.FilterTasks();
        StateHasChanged();
    }
    public async void refreshOnAddTask(){
        await taskService.addTask.AddTask();
        await taskService.showTask.FilterTasks();
        StateHasChanged();
    }
   
}